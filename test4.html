<!DOCTYPE html>
<html lang="en">
<head>
<meta name="description" content="MostefaouiAnime - Social network for anime fans!">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mostefaouiAnime | Shadow Network</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --aura-blue: #00adff;
            --aura-dark: #121212;
            --aura-gradient: linear-gradient(135deg, #00adff, #0077ff);
        }

        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #000 url('2.jpg') no-repeat center center/cover fixed;
            margin: 0;
            padding: 0;
            color: white;
            min-height: 100vh;
        }

        /* Modern Navbar */
        .navbar {
            background: rgba(18, 18, 18, 0.95);
            backdrop-filter: blur(10px);
            padding: 12px 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(0, 173, 255, 0.15);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.5);
        }

        .logo {
            color: var(--aura-blue);
            font-weight: 800;
            font-size: 24px;
            text-shadow: 0 0 15px rgba(0, 173, 255, 0.7);
            letter-spacing: 1px;
            background: linear-gradient(to right, #00adff, #00fff2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            transition: all 0.3s ease;
        }

        .logo:hover {
            text-shadow: 0 0 20px rgba(0, 173, 255, 0.9);
        }

        /* Enhanced Search */
        .search-container {
            position: relative;
            width: 300px;
            transition: all 0.3s ease;
        }

        .search-bar {
            background: rgba(30, 30, 30, 0.8);
            border: 1px solid rgba(0, 173, 255, 0.2);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            width: 100%;
            font-size: 14px;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }

        .search-bar:focus {
            outline: none;
            border-color: var(--aura-blue);
            box-shadow: 0 0 10px rgba(0, 173, 255, 0.3);
            width: 350px;
        }

        .search-results {
            position: absolute;
            top: 50px;
            left: 0;
            background: rgba(30, 30, 30, 0.95);
            border: 1px solid rgba(0, 173, 255, 0.2);
            width: 100%;
            border-radius: 12px;
            max-height: 400px;
            overflow-y: auto;
            display: none;
            z-index: 1000;
            backdrop-filter: blur(20px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.2s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Profile Card */
        .profile-card {
            display: flex;
            align-items: center;
            padding: 15px;
            transition: all 0.2s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .profile-card:hover {
            background: rgba(0, 173, 255, 0.05);
        }

        .profile-pic {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: var(--aura-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            margin-right: 15px;
            flex-shrink: 0;
            box-shadow: 0 0 15px rgba(0, 173, 255, 0.3);
            transition: all 0.3s ease;
        }

        .profile-pic.default {
            color: white;
            font-weight: bold;
            font-size: 18px;
        }

        .profile-pic img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .profile-info {
            flex-grow: 1;
        }

        .profile-name {
            font-weight: 600;
            margin-bottom: 3px;
        }

        .profile-email {
            font-size: 12px;
            color: #aaa;
        }

        /* Buttons */
        .btn {
            padding: 8px 16px;
            border-radius: 20px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--aura-gradient);
            color: white;
            box-shadow: 0 2px 10px rgba(0, 173, 255, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 173, 255, 0.4);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--aura-blue);
            color: var(--aura-blue);
        }

        /* Main Content */
        .container {
            display: flex;
            max-width: 1200px;
            margin: 30px auto;
            gap: 20px;
            padding: 0 20px;
        }

        .sidebar {
            width: 300px;
            flex-shrink: 0;
        }

        .main-content {
            flex-grow: 1;
        }

        /* Profile Setup Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(10px);
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: rgba(30, 30, 30, 0.95);
            border: 1px solid rgba(0, 173, 255, 0.3);
            border-radius: 15px;
            width: 450px;
            max-width: 90%;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #00adff;
        }

        .form-group input, 
        .form-group textarea {
            width: 100%;
            padding: 10px;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(0, 173, 255, 0.3);
            border-radius: 5px;
            color: white;
        }

        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }

        /* Profile Dropdown */
        .profile-dropdown {
            position: absolute;
            right: 20px;
            top: 70px;
            background: rgba(30, 30, 30, 0.95);
            border: 1px solid rgba(0, 173, 255, 0.3);
            border-radius: 10px;
            width: 250px;
            padding: 15px;
            display: none;
            z-index: 1001;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
        }

        .profile-dropdown.show {
            display: block;
            animation: fadeIn 0.2s ease-out;
        }

        .profile-dropdown .profile-pic {
            width: 60px;
            height: 60px;
            margin: 0 auto 15px;
        }

        .profile-dropdown .profile-name {
            text-align: center;
            font-size: 18px;
            margin-bottom: 5px;
        }

        .profile-dropdown .profile-email {
            text-align: center;
            margin-bottom: 15px;
        }

        .profile-dropdown .profile-bio {
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar">
        <div class="logo">mostefaouiAnime</div>
        
        <div class="search-container">
            <input type="text" class="search-bar" placeholder="Search hunters..." id="searchBar">
            <div class="search-results" id="searchResults"></div>
        </div>
        
        <div class="profile-pic" id="userProfilePic" style="cursor: pointer;">
            <i class="fas fa-user"></i>
        </div>
        
        <!-- Profile Dropdown -->
        <div class="profile-dropdown" id="profileDropdown">
            <div class="profile-pic" id="dropdownProfilePic">
                <i class="fas fa-user"></i>
            </div>
            <div class="profile-name" id="dropdownProfileName">Loading...</div>
            <div class="profile-email" id="dropdownProfileEmail"></div>
            <div class="profile-bio" id="dropdownProfileBio">No bio yet</div>
            <button class="btn btn-outline" style="width: 100%;">Edit Profile</button>
        </div>
    </nav>

    <!-- Main Layout -->
    <div class="container">
        <!-- Left Sidebar -->
        <aside class="sidebar">
            <div class="profile-card" id="currentUserProfile">
                <div class="profile-pic default" id="sidebarProfilePic">
                    <i class="fas fa-user"></i>
                </div>
                <div class="profile-info">
                    <div class="profile-name" id="sidebarUserName">Loading...</div>
                    <div class="profile-email" id="sidebarUserEmail"></div>
                </div>
            </div>

            <!-- Friends List -->
            <div class="section-title">Your Party</div>
            <div id="friendsList" class="friends-list">
                <!-- Dynamically populated -->
            </div>
        </aside>

        <!-- Main Feed -->
        <main class="main-content">
            <!-- Create Post -->
            <div class="post-creator">
                <div class="profile-pic small" id="postCreatorPic"></div>
                <input type="text" placeholder="Share your dungeon run..." id="postContent">
                <div class="post-actions">
                    <button class="btn btn-primary">Post</button>
                </div>
            </div>

            <!-- Posts Feed -->
            <div id="postsFeed">
                <!-- Dynamically populated -->
            </div>
        </main>
    </div>

    <!-- Profile Setup Modal -->
    <div id="profileSetupModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2>Complete Your Hunter Profile</h2>
            
            <!-- Profile Picture Upload -->
            <div class="profile-pic large" id="profilePicPreview" style="background-color: black; margin: 0 auto 20px;">
                <input type="file" id="profilePicUpload" accept="image/*" style="display: none;">
                <i class="fas fa-user" style="color: white; font-size: 40px;"></i>
            </div>
            <button class="btn btn-outline" onclick="document.getElementById('profilePicUpload').click()" style="margin-bottom: 20px;">
                Choose Profile Image (Optional)
            </button>
            
            <!-- Name Field (Required) -->
            <div class="form-group">
                <label for="displayName">Hunter Name (Required)</label>
                <input type="text" id="displayName" placeholder="Enter your hunter name" required>
            </div>
            
            <!-- Bio Field (Optional) -->
            <div class="form-group">
                <label for="userBio">Hunter Bio (Optional)</label>
                <textarea id="userBio" placeholder="Tell others about your hunting skills..."></textarea>
            </div>
            
            <button class="btn btn-primary" id="saveProfileBtn" style="width: 100%;">
                Save Profile
            </button>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>

    <script>
        // Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyC7tWHrfj6pAzFkS4rW_EfhSl6viAZUUC4",
            authDomain: "mostefmountanime.firebaseapp.com",
            projectId: "mostefmountanime",
            storageBucket: "mostefmountanime.appspot.com",
            messagingSenderId: "urlusBscsp",
            appId: "1:41115808501:web:bysoft.readn3.cf592cadde"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        // DOM Elements
        const elements = {
            searchBar: document.getElementById('searchBar'),
            searchResults: document.getElementById('searchResults'),
            userProfilePic: document.getElementById('userProfilePic'),
            profileDropdown: document.getElementById('profileDropdown'),
            profileSetupModal: document.getElementById('profileSetupModal'),
            profilePicUpload: document.getElementById('profilePicUpload'),
            profilePicPreview: document.getElementById('profilePicPreview'),
            displayName: document.getElementById('displayName'),
            userBio: document.getElementById('userBio'),
            saveProfileBtn: document.getElementById('saveProfileBtn'),
            sidebarUserName: document.getElementById('sidebarUserName'),
            sidebarUserEmail: document.getElementById('sidebarUserEmail'),
            friendsList: document.getElementById('friendsList'),
            postsFeed: document.getElementById('postsFeed'),
            dropdownProfilePic: document.getElementById('dropdownProfilePic'),
            dropdownProfileName: document.getElementById('dropdownProfileName'),
            dropdownProfileEmail: document.getElementById('dropdownProfileEmail'),
            dropdownProfileBio: document.getElementById('dropdownProfileBio')
        };

        // Global State
        let currentUser = null;
        let userProfile = null;

        // Auth State Listener
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = user;
                checkProfileSetup(user);
                loadUserProfile(user);
                loadFriendsList(user);
                loadPostsFeed();
            } else {
                // Redirect to login if not authenticated
                window.location.href = 'test3.html';
            }
        });

        // Check if profile needs setup
        async function checkProfileSetup(user) {
            const profileDoc = await db.collection('profiles').doc(user.uid).get();
            if (!profileDoc.exists) {
                elements.profileSetupModal.style.display = 'flex';
            }
        }

        // Load user profile data
        async function loadUserProfile(user) {
            const profileDoc = await db.collection('profiles').doc(user.uid).get();
            if (profileDoc.exists) {
                userProfile = profileDoc.data();
                updateProfileDisplay();
            }
        }

        // Update UI with profile data
        function updateProfileDisplay() {
            if (!userProfile) return;

            // Update sidebar
            elements.sidebarUserName.textContent = userProfile.displayName || 'Hunter';
            elements.sidebarUserEmail.textContent = currentUser.email;

            // Update dropdown
            elements.dropdownProfileName.textContent = userProfile.displayName || 'Hunter';
            elements.dropdownProfileEmail.textContent = currentUser.email;
            elements.dropdownProfileBio.textContent = userProfile.bio || 'No bio yet';

            // Update all profile pictures
            const profilePics = [
                elements.userProfilePic,
                elements.sidebarProfilePic,
                elements.dropdownProfilePic
            ];
            
            profilePics.forEach(pic => {
                if (userProfile.photoURL) {
                    pic.innerHTML = `<img src="${userProfile.photoURL}" alt="Profile">`;
                    pic.classList.remove('default');
                } else {
                    // Set black background for default profile
                    pic.style.backgroundColor = 'black';
                    const initial = userProfile.displayName ? userProfile.displayName.charAt(0).toUpperCase() : '?';
                    pic.innerHTML = initial;
                    pic.classList.add('default');
                }
            });
        }

        // Toggle profile dropdown
        elements.userProfilePic.addEventListener('click', (e) => {
            e.stopPropagation();
            elements.profileDropdown.classList.toggle('show');
        });

        // Close dropdown when clicking elsewhere
        document.addEventListener('click', () => {
            elements.profileDropdown.classList.remove('show');
        });

        // Profile picture upload handler
        elements.profilePicUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    elements.profilePicPreview.innerHTML = 
                        `<img src="${event.target.result}" style="width:100%;height:100%;object-fit:cover;">`;
                };
                reader.readAsDataURL(file);
            }
        });

        // Save profile handler
        elements.saveProfileBtn.addEventListener('click', async () => {
            const displayName = elements.displayName.value.trim();
            if (!displayName) {
                alert('Please enter your hunter name!');
                return;
            }

            let photoURL = null;
            const file = elements.profilePicUpload.files[0];
            const bio = elements.userBio.value.trim();
            
            if (file) {
                // Upload to Firebase Storage
                const storageRef = storage.ref(`profile_pics/${currentUser.uid}`);
                const snapshot = await storageRef.put(file);
                photoURL = await snapshot.ref.getDownloadURL();
            }

            // Save profile data
            await db.collection('profiles').doc(currentUser.uid).set({
                displayName,
                photoURL,
                bio,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
            });

            // Close modal and refresh
            elements.profileSetupModal.style.display = 'none';
            await loadUserProfile(currentUser);
        });

        // [Implement search functionality]
        // [Implement friends system]
        // [Implement posts system]
    </script>
</body>
</html>